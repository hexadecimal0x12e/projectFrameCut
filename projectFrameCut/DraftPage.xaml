<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
             xmlns:vm="clr-namespace:projectFrameCut.ViewModels"
             xmlns:conv="clr-namespace:projectFrameCut.Converters"
             x:Class="projectFrameCut.DraftPageOld"
             x:Name="MainPageRoot"
             xmlns:l="clr-namespace:LocalizedResources"
             NavigatedTo="MainPageRoot_NavigatedTo"
             Title="default draft page">
    <ContentPage.ToolbarItems>
        <ToolbarItem Text="{l:Localized Key=DraftPage_GoRender}" Clicked="OnExportDraft" Order="Primary" Priority="0" />
        <ToolbarItem Text="Options"/>
    </ContentPage.ToolbarItems>

    <ContentPage.Resources>
        <ResourceDictionary>
            <conv:SecondsToPixelsConverter x:Key="SecondsToPixelsConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>
    <!-- Add a dedicated row for the ruler above the scrollable tracks -->
    <Grid RowDefinitions="Auto,Auto,*,Auto,250,26">
        <!-- Toolbar 
        <ScrollView Orientation="Horizontal">
            
        </ScrollView>-->
        <!-- Ruler row aligned with timeline (outside ScrollView so it doesn't affect content width) -->
        <Grid Grid.Row="1" ColumnDefinitions="140,*">
            <!-- Left gutter to align with track headers width -->
            <BoxView Grid.Column="0" WidthRequest="140" Color="Transparent" />
            <!-- Ruler area -->
            <Grid Grid.Column="1" BackgroundColor="#222" HeightRequest="24">
                <Grid.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnRulerTapped" />
                </Grid.GestureRecognizers>
                <AbsoluteLayout x:Name="Ruler" />
            </Grid>
        </Grid>

        <!-- Tracks & Timeline -->
        <ScrollView x:Name="TimelineScroll" Grid.Row="2" Orientation="Both" Scrolled="OnTimelineScrolled">
            <!-- Make second column Auto so it can grow wider than viewport -->
            <Grid x:Name="TimelineGrid" ColumnDefinitions="Auto,Auto" RowSpacing="0">
                <!-- Track headers -->
                <VerticalStackLayout x:Name="TracksHeader" WidthRequest="140" BackgroundColor="LightGray" Spacing="1" />

                <!-- Timeline canvas sized by TimelineWidth to enable horizontal scroll -->
                <Grid Grid.Column="1" x:Name="TimelineCanvas" WidthRequest="{Binding TimelineWidth}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <!-- Tracks area -->
                    <VerticalStackLayout Grid.Row="0" x:Name="TracksPanel" Spacing="1" />

                    <!-- Playhead line -->
                    <BoxView x:Name="Playhead" Color="Red" WidthRequest="2" HorizontalOptions="Start" VerticalOptions="Fill" />
                </Grid>
            </Grid>
        </ScrollView>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧按钮组 -->
            <HorizontalStackLayout Grid.Column="0" Padding="8" Spacing="8">
                <Button x:Name="AddSolidColorClip" Clicked="AddSolidColorClip_Clicked" Text="Add Solid Color"/>
                <Button Text="Add Track" Clicked="OnAddTrack" />
                <Button Text="Split" Clicked="OnSplitClip" />
                <Button Text="Delete" Clicked="OnDeleteClip" />
                <Label Text="" WidthRequest="300"/>
                <Button Text="Play/Pause" />

            </HorizontalStackLayout>

            <!-- 中间的播放按钮 -->
            <Grid Grid.Column="1"  HorizontalOptions="Center" Padding="8">

            </Grid>

            <!-- 右侧区域：缩放按钮和状态 -->
            <HorizontalStackLayout Grid.Column="2" Spacing="8">
                <HorizontalStackLayout Padding="8" Spacing="8">
                    <Button Text="-" Clicked="OnZoomOut" />
                    <Button Text="+" Clicked="OnZoomIn" />
                </HorizontalStackLayout>

            </HorizontalStackLayout>
        </Grid>
        <!-- Status bar -->

        <!-- Preview & asset area -->
        <Grid Grid.Row="4" BackgroundColor="#111">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="2*" />
                </Grid.ColumnDefinitions>
                <!-- Asset library panel -->
                <Border Grid.Column="0" StrokeThickness="5" Padding="4" >
                    <Grid RowDefinitions="Auto,*">
                        <HorizontalStackLayout Spacing="8" Padding="0,0,0,4">
                            <Button Text="添加素材" Clicked="OnAddAsset" />
                            <Label Text="素材库" VerticalOptions="Center" FontAttributes="Bold" />
                        </HorizontalStackLayout>
                        <CollectionView Grid.Row="1"
                                        ItemsSource="{Binding Source={x:Reference MainPageRoot}, Path=Assets}"
                                        SelectionMode="None">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Grid ColumnDefinitions="Auto,*,Auto" Padding="4" Margin="0,2">
                                        <Label Text="{Binding Icon}" FontSize="16" />
                                        <Label Grid.Column="1" Text="{Binding Name}" LineBreakMode="TailTruncation" />
                                        <Button Grid.Column="2" Text="+" Padding="0" WidthRequest="32" HeightRequest="28"
                                                Clicked="OnAddAssetToTimeline" CommandParameter="{Binding .}" />
                                    </Grid>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </Grid>
                </Border>
                <!-- Preview placeholder -->
                <Border Grid.Column="2" StrokeThickness="5" Padding="4" >
                    <!--  <Label Text="Preview placeholder" TextColor="White" HorizontalOptions="Center" VerticalOptions="Center" />
                    -->

                    <Image x:Name="PreviewBox"/>
                </Border>

            </Grid>
        </Grid>

        <Grid Grid.Row="5" Padding="4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="25"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>



            <HorizontalStackLayout Grid.Column="0" >
                <VerticalStackLayout x:Name="StateIndicator"/>
            </HorizontalStackLayout>

            <HorizontalStackLayout Grid.Column="1">
                <Label x:Name="Status"
                        LineBreakMode="NoWrap"
                        Text="Everything fine" />

            </HorizontalStackLayout>

            <HorizontalStackLayout HorizontalOptions="End" Grid.Column="2">
                <Label x:Name="BackendStatus"
                    Text="" />
                <Ellipse x:Name="BackendStateIndicator" WidthRequest="16" HeightRequest="16" Fill="Gray" Margin="4,3,0,0" />
            </HorizontalStackLayout>

        </Grid>
    </Grid>
</ContentPage>